<!DOCTYPE html>
<html lang="es" xmlns:sec="http://www.w3.org/1999/xhtml" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Gestion de Tienda</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-md-7 mt-3 mb-2">
                <h2>Gestión de Productos</h2>
            </div>

            <div sec:authentication="name" class="col-md-2 mt-4 fw-bold"></div>

            <div class="col-md-3 d-flex justify-content-between align-items-center">
                <span sec:authorize="hasRole('Admin')">
                    <button id="toggleListado" class="btn btn-primary me-3">Cambiar Estado</button>
                </span>
                <form th:action="@{/start/logout}" method="post" class="ms-auto">
                    <button type="submit" class="btn btn-danger">
                        Cerrar sesión
                    </button>
                </form>
            </div>
        </div>

        <div id="productosContainer">
            <div th:replace="fragments/productos :: productosTable"></div>
        </div>
    </div>

    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-S09PlsURuqPH49oZ7m4IltUpzzI2spZ6XGJ9QYXiKwLDRKK21wZWYqK7qreU53C0"
        crossorigin="anonymous"
></script>
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        let listado = true;

        const toggleButton = document.getElementById("toggleListado");
        const productosContainer = document.getElementById("productosContainer");

        toggleButton.addEventListener("click", () => {
            listado = !listado; // Cambiar el estado
            fetch(`/start/products-fragment?listado=${listado}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Error al cargar los datos.");
                    }
                    return response.text(); // Devuelve el fragmento HTML como texto
                })
                .then(fragment => {
                    // Reemplazar el contenido de la tabla
                    productosContainer.innerHTML = fragment;
                })
                .catch(error => {
                    console.error("Error al actualizar los datos:", error);
                    alert("Hubo un error al actualizar los datos.");
                });
        });
    });
</script>

</body>
</html>